core:
  network: true

plugins:
  verifier:
    conditions:
      net_external:
        type: file_contains
        file: console.log
        string: "/tests/net_external.sh PASS"


static_files:
  /tests/net_external.sh:
    type: inline_file
    contents: |
      #!/igloo/utils/sh
      set -ex

      /igloo/utils/busybox ip addr add 10.0.2.15/24 dev eth0
      /igloo/utils/busybox ip route add default via 10.0.2.2

      /igloo/utils/busybox ping -c 8.8.8.8

      if [ $? -ne 0 ]; then
        echo "FAILED to ping external IP"
        exit 1
      else
        echo "PASSED ping to external IP"
        exit 0
      fi
    mode: 73