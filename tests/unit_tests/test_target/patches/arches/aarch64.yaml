core:
  arch: aarch64

static_files:
  /igloo/utils/*:
    host_path: /igloo_static/aarch64/*
    mode: 493
    type: host_file
  /igloo/dylibs/*:
    host_path: /igloo_static/dylibs/arm64/*
    mode: 493
    type: host_file
  /igloo/armel/*:
    host_path: /igloo_static/armel/*
    mode: 493
    type: host_file
  /tests/arm32_hypercall.sh:
    type: inline_file
    contents: |
      #!/igloo/utils/sh
      set -x
      set +e # ignore non-zero exit code
      /igloo/armel/send_hypercall_raw 0xcafebab3 0xdeadbeeff1f1f1f1 0x1337c0defeedc0de 0xdeadbeeff1f1f1f2 0x1337c0def2f2f2f2
      if [ $? -ne 13 ]; then
        echo "Error: Hypercall failed"
        exit 1
      else
        echo "send_hypercall_raw retval correct"
        exit 0
      fi
    mode: 73


plugins:
  verifier:
    conditions:
      arm32hypercall+console:
        type: file_contains
        file: console.log
        string: "/tests/arm32_hypercall.sh PASS"
      arm32hypercall+stdout:
        type: file_contains
        file: shared/tests/arm32_hypercall.sh/stdout
        string: "do_hypercall returned: "