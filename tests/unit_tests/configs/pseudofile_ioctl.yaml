core:
  root_shell: false

env:
  igloo_init: /init

pseudofiles:
  /dev/missing: {}
  /dev/fs/missing: {}
  /dev/foo/missing: {}

static_files:
  /init:
    type: inline_file
    contents: |
      #!/igloo/utils/sh
      set -ux
      
      # First check existance of device explicitly to make sure that it's present
      if [ ! -e /dev/missing ]; then
        /igloo/utils/busybox ls -alt /dev/missing
        echo "Missing /dev/missing (unexpected)"
        exit 1
      fi

      # Run hdparam on each device which issues ioctl HDIO_DRIVE_CMD twice
      /igloo/utils/busybox hdparm -I /dev/missing
      /igloo/utils/busybox hdparm -I /dev/fs/missing
      /igloo/utils/busybox hdparm -I /dev/foo/missing

      echo "tests pass"
      exit 0
    mode: 73
