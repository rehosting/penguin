core:
  root_shell: false

env:
  igloo_init: /init

pseudofiles:
  /dev/mtd100:
    name: fakemtd
static_files:
  /init:
    type: inline_file
    contents: |
      #!/igloo/utils/micropython

      import ffi

      lib_inject = ffi.open("lib_inject.so")

      strstr = lib_inject.func("s", "strstr", "ss")

      device_path = None
      with open("/proc/mtd") as f:
        for line in f:
          if strstr(line, "flash"):
            device = line.split(":")[0]
            device_path = f"/dev/{device}"
            break

      print("flash device path:", device_path)
    mode: 73
